<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clasificador de Cursos — Docente vs Profesional</title>
  <style>
    :root{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;}
    body{margin:0;background:#f6f7fb;color:#111;padding:20px}
    .container{max-width:1100px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(20,30,60,0.08)}
    h1{margin:0 0 10px;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    textarea{width:100%;height:160px;font-family:monospace;padding:10px;border-radius:6px;border:1px solid #e3e6ee}
    input[type=file]{width:100%}
    button{background:#0b63d6;color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #eef2f8;font-size:13px}
    th{background:#fbfdff;text-align:left}
    .badge{display:inline-block;padding:6px 8px;border-radius:8px;font-size:12px}
    .docente{background:#fbe9e6;color:#a33}
    .profesional{background:#e8f6ff;color:#036}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:12px;color:#666}
    .explain{font-size:13px;color:#334;margin-top:6px}
    .reason{font-size:12px;color:#555}
    .override{background:#fff;border:1px solid #ddd;padding:6px;border-radius:6px}
    .download{margin-left:auto}
    .footer{font-size:13px;color:#666;margin-top:14px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Clasificador de Cursos — <span class="small">Docente vs Profesional</span></h1>
    <p class="explain">Sube un CSV o pega cursos (CSV o JSON) para que el clasificador aplique tus criterios y marque cada curso como <strong>Docente</strong> o <strong>Profesional</strong>. Puedes editar resultados manualmente y descargar el archivo con la clasificación.</p>

    <div class="grid">
      <div>
        <label><strong>Pegar contenido (CSV o JSON)</strong></label>
        <textarea id="inputData" placeholder="Ejemplo CSV: \nTitle,Duracion,Modalidad,Fechas,DirigidoA,Objetivo,Contenido\nCurso SolidWorks,30,Presencial,19-23 ene 2026,Docente de Ciencias Basicas,Adiestrar en manejo del software,Software y modelado"></textarea>

        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <input type="file" id="fileInput" accept=".csv,.txt" />
          <button id="parseBtn">Procesar</button>
          <button id="clearBtn" style="background:#666">Limpiar</button>
          <div class="download" style="margin-left:auto">
            <button id="downloadBtn" style="background:#0a9d58">Descargar CSV</button>
          </div>
        </div>

        <div style="margin-top:8px">
          <label class="small">Heurísticas (palabras clave usadas para clasificar)</label>
          <div class="small reason">Docente keywords: <em>pedagog</em>, <em>didáct</em>, <em>psicolog</em>, <em>teoría</em>, <em>formación inicial</em>, <em>estudiantes</em></div>
          <div class="small reason">Profesional keywords: <em>actualiz</em>, <em>práctic</em>, <em>manejo</em>, <em>software</em>, <em>taller</em>, <em>docente en ejercicio</em></div>
        </div>

      </div>

      <div>
        <label><strong>Resumen</strong></label>
        <div style="padding:12px;background:#fbfdff;border-radius:8px;border:1px solid #eef5ff">
          <div class="small">Cursos procesados: <span id="count">0</span></div>
          <div class="small">Docente: <span id="countDoc">0</span> &nbsp; Profesional: <span id="countProf">0</span></div>
          <div style="margin-top:8px" class="small">Haz doble clic en la clasificación para editarla manualmente.</div>
        </div>

        <div style="margin-top:12px">
          <label class="small"><strong>Vista previa / Edición</strong></label>
          <div id="tableWrap" style="max-height:420px;overflow:auto;border:1px solid #eef2f8;border-radius:8px;margin-top:8px;padding:6px"></div>
        </div>

      </div>
    </div>

    <div class="footer">Instrucciones rápidas: Subir CSV con cabeceras (Title,Duracion,Modalidad,Fechas,DirigidoA,Objetivo,Contenido) o pegar JSON/CSV. El clasificador usa coincidencias parciales (contains) en campos dirigidos a participantes, objetivo o contenido. Puedes ajustar palabras clave en el código.</div>
  </div>

  <script>
    // Utilidades
    const csvToArray = (text) => {
      const lines = text.split(/\r?\n/).filter(l=>l.trim()!="");
      if(lines.length===0) return [];
      const sep = (lines[0].includes(';') && !lines[0].includes(','))?';':',';
      const headers = lines[0].split(sep).map(h=>h.trim());
      const rows = lines.slice(1).map(l=>{
        const cols = l.split(sep).map(c=>c.trim());
        const obj = {};
        headers.forEach((h,i)=>obj[h]=cols[i]??"");
        return obj;
      });
      return rows;
    }

    const downloadCSV = (rows) => {
      if(!rows || !rows.length) return;
      const keys = Object.keys(rows[0]);
      const lines = [keys.join(',')];
      rows.forEach(r => {
        const vals = keys.map(k => '"'+String(r[k]??'').replace(/"/g,'""')+'"');
        lines.push(vals.join(','));
      });
      const blob = new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='cursos_clasificados.csv'; a.click(); URL.revokeObjectURL(url);
    }

    // Heurísticas (puedes editarlas en este bloque)
    const heuristics = {
      docente: ['pedagog','didáct','psicolog','teoría','teoria','formación inicial','formacion inicial','estudiante','inicial','normales','licenciatura','bases pedagógicas'],
      profesional: ['actualiz','actualización','práctic','practica','manejo','software','taller','curso para docentes','docente en ejercicio','especializ','aplicad','competenc','práctica','aplicad']
    };

    function classifyCourse(course){
      // fields to check
      const fields = [course.Title, course.DirigidoA, course.Objetivo, course.Contenido, course.Modalidad, course.Temas, course.Descripcion, course['Dirigido A']].filter(Boolean).join('\n').toLowerCase();
      let scoreDoc = 0, scoreProf = 0;
      heuristics.docente.forEach(k=>{ if(fields.includes(k)) scoreDoc+=1 });
      heuristics.profesional.forEach(k=>{ if(fields.includes(k)) scoreProf+=1 });

      // additional rules: if target mentions 'docente' but also 'en ejercicio' -> professional
      if((course.DirigidoA||'').toLowerCase().includes('docente') && (course.DirigidoA||'').toLowerCase().includes('ejercicio')) scoreProf+=2;

      // if participants appear to be students or initial -> docente
      if((course.DirigidoA||'').toLowerCase().includes('estudiante') || (course.DirigidoA||'').toLowerCase().includes('norma')) scoreDoc+=2;

      // fallback: if no strong signal, check modality and objetivo words
      if(scoreDoc===0 && scoreProf===0){
        if((course.Objetivo||'').toLowerCase().match(/actualiz|mejorar|adaptar|resolv|uso|manejo|práctic/)) scoreProf+=1;
        if((course.Objetivo||'').toLowerCase().match(/formar|desarrollar|teoría|pedagog/)) scoreDoc+=1;
      }

      const result = scoreProf>scoreDoc? 'Profesional' : (scoreDoc>scoreProf? 'Docente' : 'Profesional');
      const reason = `scoreDoc=${scoreDoc}, scoreProf=${scoreProf}`;
      return {result,reason,scoreDoc,scoreProf};
    }

    // Render table
    let currentRows = [];
    function renderTable(rows){
      currentRows = rows.map(r=>({...r}));
      const wrap = document.getElementById('tableWrap');
      document.getElementById('count').textContent = rows.length;
      const counts = {Docente:0, Profesional:0};
      let html = '<table><thead><tr><th>Título</th><th>Dirigido a</th><th>Objetivo / Contenido</th><th>Clasificación</th><th>Razón</th></tr></thead><tbody>';
      rows.forEach((r,i)=>{
        const {result,reason} = classifyCourse(r);
        r._pred = result; r._reason = reason; // store
        counts[result] = (counts[result]||0)+1;
        html += `<tr data-index="${i}">`+
                `<td>${escapeHtml(r.Title||r.title||'')}</td>`+
                `<td>${escapeHtml(r.DirigidoA||r['Dirigido A']||r.target||'')}</td>`+
                `<td><div class="small">${escapeHtml((r.Objetivo||r.Contenido||r.Content||'').slice(0,220))}</div></td>`+
                `<td><span class="badge ${result==='Docente'?'docente':'profesional'}" data-role="badge">${result}</span></td>`+
                `<td class="reason">${escapeHtml(reason)}</td>`+
                `</tr>`;
      });
      html += '</tbody></table>';
      wrap.innerHTML = html;
      document.getElementById('countDoc').textContent = counts['Docente']||0;
      document.getElementById('countProf').textContent = counts['Profesional']||0;

      // attach double-click handlers to toggle classification
      wrap.querySelectorAll('tr').forEach(tr=>{
        tr.addEventListener('dblclick', ()=>{
          const idx = Number(tr.dataset.index);
          const r = currentRows[idx];
          const newVal = prompt('Editar clasificación (Docente / Profesional)', r._pred) || r._pred;
          const normalized = newVal.trim().toLowerCase().startsWith('d')? 'Docente' : 'Profesional';
          r._pred = normalized;
          // update UI badge & counts
          renderTable(currentRows);
        });
      });
    }

    function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // Parse input and detect format
    function parseInput(text){
      text = text.trim();
      if(!text) return [];
      // try JSON
      try{ const j = JSON.parse(text); if(Array.isArray(j)) return j.map(normalizeRow);
        if(typeof j === 'object') return [normalizeRow(j)];
      }catch(e){}

      // try CSV
      const asRows = csvToArray(text);
      if(asRows && asRows.length) return asRows.map(normalizeRow);

      // fallback: each line is a title
      return text.split(/\r?\n/).filter(l=>l.trim()).map(l=>normalizeRow({Title:l.trim()}));
    }

    function normalizeRow(r){
      // normalize keys to expected names
      const out = {};
      const map = {title:['Title','title','Titulo','titulo'], dur:['Duracion','duracion','Horas','horas','Duración'], modal:['Modalidad','modalidad'], fechas:['Fechas','fechas','Fecha'], dirigido:['DirigidoA','Dirigido A','dirigidoa','dirigido','Dirigido'], objetivo:['Objetivo','objetivo','Objetivos'], contenido:['Contenido','contenido','Temas','temas','Descripcion','descripcion','Content','content']};
      Object.keys(r).forEach(k=>{
        const val = r[k];
        const kk = k.replace(/\s+/g,'');
        out[k] = val;
      });
      // fill canonical fields
      out.Title = r.Title||r.title||r.Titulo||r.titulo||r['Título']||r['titulo']||r.Title||'';
      out.Duracion = r.Duracion||r.duracion||r.Horas||r.horas||r.Duración||'';
      out.Modalidad = r.Modalidad||r.modalidad||'';
      out.Fechas = r.Fechas||r.fechas||r.Fecha||'';
      out.DirigidoA = r.DirigidoA||r['Dirigido A']||r.dirigido||r.target||r.Dirigido||'';
      out.Objetivo = r.Objetivo||r.objetivo||r.Objetivos||'';
      out.Contenido = r.Contenido||r.contenido||r.Temas||r.temas||r.Descripcion||r.descripcion||r.Content||r.content||'';
      return out;
    }

    document.getElementById('parseBtn').addEventListener('click', ()=>{
      const text = document.getElementById('inputData').value;
      const rows = parseInput(text);
      renderTable(rows);
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      document.getElementById('inputData').value=''; document.getElementById('tableWrap').innerHTML=''; document.getElementById('count').textContent='0'; document.getElementById('countDoc').textContent='0'; document.getElementById('countProf').textContent='0'; currentRows=[];
    });

    document.getElementById('fileInput').addEventListener('change',(e)=>{
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = () => { document.getElementById('inputData').value = reader.result; };
      reader.readAsText(f,'utf-8');
    });

    document.getElementById('downloadBtn').addEventListener('click', ()=>{
      // prepare rows with final classification
      if(!currentRows || !currentRows.length) return alert('No hay datos para descargar');
      const out = currentRows.map(r=>({
        Title: r.Title||'', Duracion: r.Duracion||'', Modalidad: r.Modalidad||'', Fechas: r.Fechas||'', DirigidoA: r.DirigidoA||'', Objetivo: r.Objetivo||'', Contenido: r.Contenido||'', Clasificacion: r._pred||r._pred||'' , Razon: r._reason||''
      }));
      downloadCSV(out);
    });

    // auto-fill sample for convenience
    document.addEventListener('DOMContentLoaded', ()=>{
      const sample = 'Title,Duracion,Modalidad,Fechas,DirigidoA,Objetivo,Contenido\nCurso para principiantes de SolidWorks,30,Presencial,19-23 enero 2026,Docente de Ciencias Basicas,Adiestrar en temas y manejo del Software,Modelado 3D y software';
      document.getElementById('inputData').value = sample;
      // do not auto-parse to let user click
    });

  </script>
</body>
</html>