<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Herramienta IA â€“ Uso Interno</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#eef1f4;
}
header{
  background:#1b396a;
  color:#fff;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{
  display:flex;
  gap:12px;
  padding:12px;
}
aside{
  width:280px;
  background:#fff;
  border-radius:6px;
  padding:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
section{
  flex:1;
  background:#fff;
  border-radius:6px;
  padding:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
button{
  width:100%;
  padding:8px;
  margin-bottom:6px;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
.btn-ai{background:#1b396a;color:#fff;}
.btn-sec{background:#777;color:#fff;}
.btn-warn{background:#b33;color:#fff;}
input, textarea{
  width:100%;
  margin-bottom:6px;
  padding:6px;
}
canvas{
  border:1px solid #ccc;
}
#loader{
  display:none;
  margin:6px 0;
  color:#1b396a;
  font-weight:bold;
}
#loader.active{display:block;}
small{opacity:.7;}
</style>
</head>

<body>

<header>
  <strong>Herramienta IA Interna</strong>
  <small>Uso limitado</small>
</header>

<main>

<!-- PANEL IZQUIERDO -->
<aside>

  <button class="btn-ai" onclick="quickUse()">âš¡ Uso rÃ¡pido institucional</button>
  <button class="btn-ai" onclick="generateBackground()">ðŸŽ¨ Generar fondo IA</button>
  <button class="btn-ai" onclick="removeBackground()">âœ‚ Quitar fondo</button>

  <hr>

  <button class="btn-sec" onclick="saveTemplate()">ðŸ’¾ Guardar plantilla</button>
  <button class="btn-sec" onclick="loadTemplate()">ðŸ“‚ Cargar plantilla</button>

  <hr>

  <button class="btn-warn" onclick="clearCanvas()">ðŸ—‘ Limpiar todo</button>

  <div id="loader">Procesando IAâ€¦</div>

</aside>

<!-- ÃREA DE TRABAJO -->
<section>

  <canvas id="canvas" width="1000" height="600"></canvas>

  <hr>

  <strong>Texto</strong>
  <input id="txtContent" placeholder="Texto institucional">
  <input id="txtSize" type="number" value="48">
  <input id="txtColor" type="color" value="#1b396a">
  <button class="btn-sec" onclick="addText()">âž• Agregar texto</button>

</section>

</main>

<script type="module">
/* ===============================
   IA â€“ CONFIGURACIÃ“N
================================ */
import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

let ai=null;

function initAI(){
  const key=localStorage.getItem("GOOGLE_API_KEY");
  if(!key){
    const k=prompt("Ingresa API Key de Google Gemini:");
    if(!k)return;
    localStorage.setItem("GOOGLE_API_KEY",k);
    location.reload();
    return;
  }
  ai=new GoogleGenerativeAI(key);
}

/* ===============================
   CANVAS Y CAPAS
================================ */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let layers=[];

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  layers.forEach(l=>{
    if(l.type==="image"){
      ctx.drawImage(l.img,0,0,canvas.width,canvas.height);
    }
    if(l.type==="text"){
      ctx.fillStyle=l.color;
      ctx.font=`${l.size}px Arial`;
      ctx.fillText(l.text,l.x,l.y);
    }
  });
}

/* ===============================
   FUNCIONES IA
================================ */
async function generateImage(prompt){
  document.getElementById("loader").classList.add("active");
  const res=await ai.models.generateContent({
    model:"gemini-2.5-flash-image",
    contents:{parts:[{text:prompt}]}
  });
  document.getElementById("loader").classList.remove("active");
  for(const p of res.candidates[0].content.parts){
    if(p.inlineData)return p.inlineData.data;
  }
  return null;
}

window.generateBackground=async()=>{
  if(!ai)return alert("IA no configurada");
  const img64=await generateImage(
    "Fondo institucional moderno, acadÃ©mico, tonos azul marino y dorado, sin texto"
  );
  if(!img64)return;
  const img=new Image();
  img.onload=()=>{
    layers.unshift({type:"image",img});
    render();
  };
  img.src="data:image/png;base64,"+img64;
};

window.quickUse=async()=>{
  if(!ai)return alert("IA no configurada");
  const img64=await generateImage(
    "Banner institucional acadÃ©mico, limpio, profesional, azul marino y dorado, sin texto"
  );
  if(!img64)return;
  const img=new Image();
  img.onload=()=>{
    layers=[
      {type:"image",img},
      {type:"text",text:"TÃ­tulo institucional",x:100,y:120,size:48,color:"#1b396a"}
    ];
    render();
  };
  img.src="data:image/png;base64,"+img64;
};

window.removeBackground=async()=>{
  if(layers.length===0)return alert("No hay imagen");
  alert("FunciÃ³n ilustrativa: aquÃ­ puedes integrar eliminaciÃ³n de fondo si la requieres");
};

/* ===============================
   TEXTO
================================ */
window.addText=()=>{
  const t=document.getElementById("txtContent").value;
  if(!t)return;
  layers.push({
    type:"text",
    text:t,
    x:100,
    y:200,
    size:parseInt(txtSize.value),
    color:txtColor.value
  });
  render();
};

/* ===============================
   PLANTILLAS
================================ */
window.saveTemplate=()=>{
  localStorage.setItem("ITD_TEMPLATE",JSON.stringify(layers));
  alert("Plantilla guardada");
};

window.loadTemplate=()=>{
  const d=localStorage.getItem("ITD_TEMPLATE");
  if(!d)return alert("No hay plantilla");
  layers=JSON.parse(d);
  render();
};

/* ===============================
   UTILIDADES
================================ */
window.clearCanvas=()=>{
  layers=[];
  render();
};

/* ===============================
   INIT
================================ */
initAI();
render();

</script>

</body>
</html>
